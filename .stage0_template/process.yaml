$schema: "https://stage0/schemas/process.schema.yaml"
$id: "https://stage0/template-configurator-api/process.yaml"
title: Process file for a MongoDB configurator API template
version: "1.0"

environment:

context:
  - key: info
    type: path
    path: specifications.product.info
  - key: org
    type: path
    path: specifications.product.organization
  - key: dictionaries
    type: path
    path: specifications.catalog.data_dictionaries
  - key: architecture
    type: path
    path: specifications.architecture.architecture

requires:
  - info.name
  - info.slug
  - info.db_name
  - info.base_port
  - org.name
  - org.git_org
  - dictionaries   
  - architecture.domains

templates:
  - path: "./LICENSE"
    merge: true
  - path: "./README.md.template"
    output: "./README.md"
    merge: true
  - path: "./docs/openapi.yaml"
    merge: true
  - path: "./Makefile"
    output: "/dev/null"
    merge: true
  - path: "./Pipfile"
    merge: true
  - path: "./pyproject.toml"
    merge: true
  - path: "./api_utils/config/config.py"
    merge: true
  - path: "./tests/test_server.py"
    merge: true

  # Config Test Data files for each Collection Name
  - path: "./tests/test_data/config/STRING.template"
    mergeFor:
      items: dictionaries
      output: "./tests/test_data/config/{{name | upper}}_COLLECTION_NAME"

  # Config Test Data for Port Numbers
  - path: "./tests/test_data/config/API_PORT.template"
    mergeFor: 
      items: architecture.domains
      output: "./tests/test_data/config/{{name | upper}}_API_PORT"
      
  - path: "./tests/test_data/config/SPA_PORT.template"
    mergeFor:
      items: architecture.domains
      output: "./tests/test_data/config/{{name | upper}}_SPA_PORT"